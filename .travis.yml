language: objective-c
osx_image: xcode611

env:
  matrix:
    - RUBY_TEST_VERSION="2.0"
    - RUBY_TEST_VERSION="Current"

matrix:
  allow_failures:
    - env: RUBY_TEST_VERSION="Current"
  fast_finish: true

before_install:
  - rvm use system
  - export PATH="/System/Library/Frameworks/Ruby.framework/Versions/${RUBY_TEST_VERSION}/usr/bin":"$PATH"
  - printenv PATH
  - brew update
  - brew upgrade > /dev/null
  - ruby --version
  - echo ls_ruby_bindir; ls "/System/Library/Frameworks/Ruby.framework/Versions/${RUBY_TEST_VERSION}/usr/bin"
  - which brew
  - export PATH="/usr/texbin":"$PATH"
  - printenv PATH

install:
  - sudo "/System/Library/Frameworks/Ruby.framework/Versions/${RUBY_TEST_VERSION}/usr/bin/gem" install mocha minitest --bindir="/System/Library/Frameworks/Ruby.framework/Versions/${RUBY_TEST_VERSION}/usr/bin"
  - echo $PWD
  - curl -L http://mirrors.rit.edu/CTAN/systems/mac/mactex/mactex-basic.pkg -o mactex-basic.pkg
  - sudo installer -pkg mactex-basic.pkg -target /
  - mkdir -p $(brew --prefix)/Library/Taps/homebrew
  - ln -s $PWD $(brew --prefix)/Library/Taps/domt4/homebrew-tex
  - brew tap --repair

script:
  - brew test-bot $TRAVIS_COMMIT --no-bottle --skip-setup -d |sed -n 's/^==> //p' |sh -ex

notifications:
    email: false
    use_notice: true
